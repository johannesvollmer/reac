<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Reac Demo</title>
    <link rel="shortcut icon" href="img/favicon.png"/>

    <link rel="stylesheet" href="css/layout.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta name="theme-color" content="rgb(255, 53, 154)"/>

    <script type="text/javascript" src="reac.js"></script>

    <style>
        * { margin: 0; padding: 0; }

        .box {
            width: 50px;
            height: 50px;
            background-color: #444;
            position: absolute;
        }

        main, main > div {
            width: 100vw;
            height: 100vh;
        }

        p {
            position: fixed;
        }
    </style>
  </head>

  <body>
    <main></main>

    <script type="text/javascript">
        const element = reac.element

        const initialState = {
            draggedBoxIndex: null,
            boxes: [ {x: 100, y: 100} ]
        }

        function render({ boxes, draggedBoxIndex }){
            const boxElements = boxes.map((box, boxIndex) => element(
                "div", 
                { className: "box", style: `transform: translate(${box.x}px, ${box.y}px)` },
                { 
                    onmousedown: (state, event) => {
                        event.stopPropagation()
                        state.draggedBoxIndex = boxIndex
                    }
                }, 
                []
            ))

            return element(
                "div", 
                {}, 
                { onmousedown: addBox, onmouseup: deselectAll, onmousemove: moveSelectedBox }, 
                
                [element("p", { innerHTML: "number of boxes: " + boxes.length }, {}, []), ...boxElements]
            )
        }

        function addBox(state, event){
            console.log("addbox")
            state.boxes.push({
                x: event.clientX - 25,
                y: event.clientY - 25
            })
        }

        function moveSelectedBox(state, event){
            if (state.draggedBoxIndex !== null){
                state.boxes[state.draggedBoxIndex].x += event.movementX
                state.boxes[state.draggedBoxIndex].y += event.movementY
            }
        }

        function deselectAll(state, event){
            state.draggedBoxIndex = null
        }

        const container = document.querySelector("main")
        reac.run(container, render, initialState)
    </script>
  </body>
</html>